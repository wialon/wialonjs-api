/**
 wialonjs-api 10, a JS library for Wialon Remote API
 Copyright (c) 2015-2018, Gurtam (http://gurtam.com)
*/
!function(e){function t(){var t=e.W;i.noConflict=function(){return e.W=t,this},e.W=i}var i={version:"10",debug:!1};"object"==typeof module&&"object"==typeof module.exports?module.exports=i:"function"==typeof define&&define.amd&&define(i),"undefined"!=typeof e&&t();var s=function(){this.dstFlags={TZ_DISABLE_DST_BIT:1,TZ_TYPE_MASK:201326592,TZ_TYPE_WITH_DST:134217728,TZ_DST_TYPE_MASK:50331648,TZ_DST_TYPE_NONE:0,TZ_DST_TYPE_SERVER:16777216,TZ_DST_TYPE_CUSTOM:33554432,TZ_CUSTOM_DST_MASK:16711680,TZ_DST_TYPE_CUSTOM_UTC:50331648,TZ_OFFSET_MASK:4294967294},this.dstRules={DST_MAR2SUN2AM_NOV1SUN2AM:65536,DST_MAR6SUN_OCT6SUN:131072,DST_MAR6SUN1AM_OCT6SUN1AM:196608,DST_MAR6THU_SEP6FRI:262144,DST_MAR6SUN2AM_OCT6SUN2AM:327680,DST_MAR30_SEP21:393216,DST_APR1SUN2AM_OCT6SUN2AM:458752,DST_APR1_OCT6SUN:524288,DST_APR6THU_SEP6THU:589824,DST_APR6THU_UNKNOWN:655360,DST_APR1_OCT1:720896,DST_MAR21_22SUN_SEP20_21SUN:786432,DST_SOUTHERN_SEMISPHERE:2097152,DST_SEP1SUNAFTER7_APR1SUNAFTER5:2097152,DST_SEP1SUN_APR1SUN:2162688,DST_SEP6SUN_APR1SUN:2228224,DST_OCT2SUN_MAR2SUN:2293760,DST_OCT1SUN_FEB3SUN:2359296,DST_OCT3SUN_MAR2SUN:2424832,DST_OCT1SUN_MAR2SUN:2490368,DST_OCT1SUN_APR1SUN:2555904,DST_OCT1SUN_MAR6SUN:2621440,DST_OCT6SUN_JAN6SUN:2686976},this._dstCache={from:{},to:{}},this.getTimeZoneOffset=function(){var e=new Date,t=new Date(e.getFullYear(),0,1,0,0,0,0),i=new Date(e.getFullYear(),6,1,0,0,0,0),s=t.toGMTString(),n=new Date(s.substring(0,s.lastIndexOf(" ")-1));s=i.toGMTString();var r=new Date(s.substring(0,s.lastIndexOf(" ")-1)),a=(t-n)/36e5,o=(i-r)/36e5;return a-o&&(a=o),Math.floor(3600*a)},this.isLeapYear=function(e){return e%4===0&&(e%100!==0||e%100===0&&e%400===0)},this.getWdayTime=function(e,t,i,s,n,r,a,o){var l=new Date;l.setUTCFullYear(e),l.setUTCMonth(t),l.setUTCDate(1),l.setUTCHours(0),l.setUTCMilliseconds(0),l.setUTCMinutes(0),l.setUTCSeconds(0);var _=0;if(s===-1)_=n;else if(_=l.getUTCDay()<=s?s-l.getUTCDay()+1:8-(l.getUTCDay()-s),i<6)if(n)for(;_<=n;)_+=7;else i&&(_+=7*(i-1));else{var u=this.getMonthDays(t,e);_+=_+28<=u?28:21}return l.setUTCDate(_),r&&l.setUTCHours(r),a&&l.setUTCMinutes(a),o&&l.setUTCSeconds(o),parseInt(l.getTime()/1e3)},this.getMonthDays=function(e,t){if(e<0||!t)return 0;var i=[31,28,31,30,31,30,31,31,30,31,30,31];return e>=i.length?0:1===e&&365===this.getYearDays(t)?29:i[e]},this.getYearDays=function(e){return e?this.isLeapYear()?365:364:0}};i.Util={extend:function(e){var t,i,s,n;for(i=1,s=arguments.length;i<s;i++){n=arguments[i];for(t in n)e[t]=n[t]}return e},create:Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}(),stamp:function(e){return e._id=e._id||++i.Util.lastId,e._id},lastId:0,falseFn:function(){return!1},formatNum:function(e,t){var i=Math.pow(10,t||5);return Math.round(e*i)/i},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},splitWords:function(e){return i.Util.trim(e).split(/\s+/)},setOptions:function(e,t){e.hasOwnProperty("options")||(e.options=e.options?i.Util.create(e.options):{});for(var s in t)e.options[s]=t[s];return e.options},getParamString:function(e,t,i){var s=[];for(var n in e)s.push(encodeURIComponent(i?n.toUpperCase():n)+"="+encodeURIComponent(e[n]));return(t&&t.indexOf("?")!==-1?"&":"?")+s.join("&")},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},write:function(){if(i.debug&&arguments.length){var t=arguments[0],s=e.console;if(s[t]||(s[t]=function(){}),1===arguments.length)return s.log(arguments[0]);if("stringify"===t){var n=arguments[1];if(n===Object(n)&&JSON)try{n=JSON.stringify(n)}catch(r){}return s.log(n)}return s[t].apply(s,Array.prototype.slice.call(arguments,1))}},time:new s},i.extend=i.Util.extend,i.stamp=i.Util.stamp,i.setOptions=i.Util.setOptions,i.logger=i.Util.write,i.Class=function(){},i.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},s=t.__super__=this.prototype,n=i.Util.create(s);n.constructor=t,t.prototype=n;for(var r in this)this.hasOwnProperty(r)&&"prototype"!==r&&(t[r]=this[r]);return e.statics&&(i.extend(t,e.statics),delete e.statics),e.includes&&(i.Util.extend.apply(null,[n].concat(e.includes)),delete e.includes),n.options&&(e.options=i.Util.extend(i.Util.create(n.options),e.options)),i.extend(n,e),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){s.callInitHooks&&s.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=n._initHooks.length;e<t;e++)n._initHooks[e].call(this)}},t},i.Class.include=function(e){i.extend(this.prototype,e)},i.Class.mergeOptions=function(e){i.extend(this.prototype.options,e)},i.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i="function"==typeof e?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)},i.Evented=i.Class.extend({on:function(e,t,s){if("object"==typeof e)for(var n in e)this._on(n,e[n],t);else{e=i.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._on(e[r],t,s)}return this},off:function(e,t,s){if(e)if("object"==typeof e)for(var n in e)this._off(n,e[n],t);else{e=i.Util.splitWords(e);for(var r=0,a=e.length;r<a;r++)this._off(e[r],t,s)}else delete this._events;return this},_on:function(e,t,s){var n=this._events=this._events||{},r=s&&s!==this&&i.stamp(s);if(r){var a=e+"_idx",o=e+"_len",l=n[a]=n[a]||{},_=i.stamp(t)+"_"+r;l[_]||(l[_]={fn:t,ctx:s},n[o]=(n[o]||0)+1)}else n[e]=n[e]||[],n[e].push({fn:t})},_off:function(e,t,s){var n=this._events,r=e+"_idx",a=e+"_len";if(n){if(!t)return delete n[e],delete n[r],void delete n[a];var o,l,_,u,c,h=s&&s!==this&&i.stamp(s);if(h)c=i.stamp(t)+"_"+h,o=n[r],o&&o[c]&&(u=o[c],delete o[c],n[a]--);else if(o=n[e])for(l=0,_=o.length;l<_;l++)if(o[l].fn===t){u=o[l],o.splice(l,1);break}u&&(u.fn=i.Util.falseFn)}},fire:function(e,t,s){if(!this.listens(e,s))return this;var n=i.Util.extend({},t,{type:e,target:this}),r=this._events;if(r){var a,o,l,_,u=r[e+"_idx"];if(r[e])for(l=r[e].slice(),a=0,o=l.length;a<o;a++)l[a].fn.call(this,n);for(_ in u)u[_].fn.call(u[_].ctx,n)}return s&&this._propagateEvent(n),this},listens:function(e,t){var i=this._events;if(i&&(i[e]||i[e+"_len"]))return!0;if(t)for(var s in this._eventParents)if(this._eventParents[s].listens(e,t))return!0;return!1},once:function(e,t,s){if("object"==typeof e){for(var n in e)this.once(n,e[n],t);return this}var r=i.bind(function(){this.off(e,t,s).off(e,r,s)},this);return this.on(e,t,s).on(e,r,s)},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[i.stamp(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[i.stamp(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,i.extend({layer:e.target},e),!0)}});var n=i.Evented.prototype;n.addEventListener=n.on,n.removeEventListener=n.clearAllEventListeners=n.off,n.addOneTimeEventListener=n.once,n.fireEvent=n.fire,n.hasEventListeners=n.listens,i.Mixin={Events:n},i.Request=i.Class.extend({options:{},_id:0,_url:"",_io:null,_counter:0,_requests:null,_callbacks:null,_frameReady:!1,initialize:function(t,s,n,r){n=i.setOptions(this,n),s=s||"/wialon/post.html",this._url=this._createFullUrl(t)+s,this._id=this._url,r&&(this._counter=r),this._requests=[],this._callbacks=[],this._io=document.createElement("iframe"),this._io.style.display="none",this._io.setAttribute("src",this._url),this._io.onload=this._frameLoaded.bind(this),this._receiveMessageHandler=this._receiveMessage.bind(this),e.addEventListener("message",this._receiveMessageHandler,!1),document.body.appendChild(this._io)},destroy:function(){e.removeEventListener("message",this._receiveMessageHandler),document.body.removeChild(this._io)},api:function(e,t,i){this.send("/wialon/ajax.html?svc="+e,t,i,i)},send:function(e,t,i,s){var n={id:++this._counter,url:e,params:this._urlEncodeData(t),source:this._id},r=this._io.contentWindow;if(r){var a=JSON.stringify(n);this._callbacks[this._counter]=[i,s,a,0],this._frameReady?r.postMessage(a,this._url):this._requests.push(a)}else s()},_createFullUrl:function(e){if(!e){var t=document.location;e=t.protocol+"//"+t.hostname+(t.port.length?":"+t.port:"")}return e},_receiveMessage:function(e){var t={error:-1};try{t=JSON.parse(e.data)}catch(s){i.logger("warn","Invalid JSON")}if(t.source===this._id)if(t.id){var n=this._callbacks[t.id];if(n){if(t&&t.text&&t.text.error&&1003===t.text.error&&n[3]<3&&(n[3]++,n[4]&&n[5]&&(clearTimeout(n[5]),n[5]=setTimeout(i.bind(this._timeout,this,this._counter),1e3*n[4])),this._io.contentWindow))return void setTimeout(i.bind(function(e){this._io.contentWindow.postMessage(e,this._url)},this,n[2]),1e3*Math.random());n[t.error]&&n[t.error](t.text),n[4]&&n[5]&&clearTimeout(n[5]),delete this._callbacks[t.id]}}else this._frameReady=!0,this._frameLoaded()},_frameLoaded:function(){if(this._frameReady)for(;this._requests.length;)this._io.contentWindow.postMessage(this._requests.pop(),this._url);else this._io.contentWindow.postMessage(JSON.stringify({id:0,source:this._id}),this._url)},_timeout:function(e){var t=this._callbacks[e];t&&(t[1]&&t[1](),delete this._callbacks[e])},_urlEncodeData:function(e){var t=[];if("object"==typeof e){for(var i in e)"object"==typeof e[i]?t.push(i+"="+encodeURIComponent(JSON.stringify(e[i]))):t.push(i+"="+encodeURIComponent(e[i]));return t.join("&")}return""}}),i.request=function(e,t){return new i.Request(e,t)},i.Session=i.Evented.extend({options:{eventsTimeout:10},api:{},_cache:{},_request:null,_serverTime:0,_eventsInterval:0,_sid:null,_url:null,_gisRenderUrl:"https://render-maps.wialon.com",_gisSearchUrl:"https://search-maps.wialon.com",_gisGeocodeUrl:"https://geocode-maps.wialon.com",_gisRoutingUrl:"https://routing-maps.wialon.com",_items:{},_classes:{},_features:{},_classItems:{},_currentUser:null,initialize:function(e,t){t=i.setOptions(this,t),this._request=new i.Request(e),this._url=e},execute:function(e,t,i){var s=(""+e).split("/"),n=["login","use_auth_hash","duplicate"];return!this._sid&&n.indexOf(s[1])===-1&&i?i({error:1}):(t=t||{},this._sid&&(t.sid=this._sid),void(s[0]in this.api&&s[1]in this.api[s[0]]?this.api[s[0]][s[1]].call(this,t,i):this._request.api(e,t,i)))},getEvents:function(){null!==this._sid&&(this._request.send("/avl_evts",{sid:this._sid},this._getEventsCallback.bind(this),this._getEventsCallback.bind(this)),this.options.eventsTimeout&&(clearTimeout(this._eventsInterval),this._eventsInterval=setTimeout(this.getEvents.bind(this),1e3*this.options.eventsTimeout)))},getBaseUrl:function(){return this._url},getItems:function(e){return this._classItems&&this._classes?(e=e||"avl_unit",this._classItems[this._classes[e]]):[]},getItem:function(e){return this._items[e]||null},getSid:function(){return this._sid},getCurrentUser:function(){return this._currentUser},getFeatures:function(){return this._features},checkFeature:function(e){if(!this._features||"undefined"==typeof this._features.svcs)return 0;if("undefined"==typeof this._features.svcs[e])return 1===this._features.unlim?1:0;var t=this._features.svcs[e];return 1===t?1:0===t?-1:0},_loginCallback:function(e,t){if(t.error)i.logger("warn","Login error");else{if(i.logger("Login success"),t.base_url&&t.base_url!==this.getBaseUrl()){this._url=t.base_url;var s=this._request._counter;this._request.destroy(),this._request=new i.Request(this._url,"",{},s)}t.gis_render&&(this._gisRenderUrl=t.gis_render.replace(/\/+$/,"")),t.gis_geocode&&(this._gisGeocodeUrl=t.gis_geocode.replace(/\/+$/,"")),t.gis_search&&(this._gisSearchUrl=t.gis_search.replace(/\/+$/,"")),t.gis_routing&&(this._gisRoutingUrl=t.gis_routing.replace(/\/+$/,"")),this._sid=t.eid,this._serverTime=t.tm,this._classes=t.classes,this._features=t.features,this._currentUser=t.user,this._registerItem(this._currentUser),this.options.eventsTimeout&&(this._eventsInterval=setTimeout(this.getEvents.bind(this),1e3*this.options.eventsTimeout))}e&&e(t)},_logoutCallback:function(e,t){t.error?i.logger("warn","Logout error"):(i.logger("Logout success"),this._destroy()),e&&e(t)},_getEventsCallback:function(e){if(!e||e.error)i.logger("log","Error getting events",e);else{this._serverTime=e.tm;for(var t=null,s=null;e.events.length;)if(t=e.events.shift(),t.i>0){if(s=this._items[t.i],!s)continue;if("m"===t.t)s.lmsg=t.d,this.fire("lastMessageChanged",t),t.d.pos&&(s.pos=t.d.pos,this.fire("positionChanged",t));else if("d"===t.t)this.fire("itemDeleted",s),this._unregisterItem(t.i);else if("u"===t.t){for(var n in t.d){var r,a,o;if("prpu"===n){r=t.d.prpu,a=i.extend({},s.prp);for(o in r)""!==r[o]?a[o]=r[o]:o in a&&delete a[o];s.prp=a}else if("prms"===n){r=t.d.prms,a=i.extend({},s.prms);for(o in r)"object"==typeof r[o]?a[o]=r[o]:"object"==typeof a[o]&&(a[o].at=r[o]);s.prms=a,this.fire("messageParamsChanged",t),"object"!=typeof r.posinfo&&"object"!=typeof r.speed||this.fire("positionChanged",t)}else s[n]=t.d[n]}this.fire("itemChanged",t)}else i.logger("log","unknown event",JSON.stringify(t))}else t.i===-3&&(this._features=t.d,this.fire("featuresChanged"));this.fire("sessionUpdated")}},_updateDataFlagsCallback:function(e,t){for(var i=0;i<t.length;i++)t[i].d?this._registerItem(t[i].d):this._unregisterItem(t[i].i);e&&e(t)},_registerItem:function(e){this._classItems[e.cls]||(this._classItems[e.cls]=[]),this._classItems[e.cls].push(e),this._items[e.id]=e},_unregisterItem:function(e){if(!e)return this;if(e in this._items){var t=this._items[e];if(this._classItems[t.cls]){var i=this._classItems[t.cls].indexOf(t);i!==-1&&this._classItems[t.cls].splice(i,1)}t=null,delete this._items[e]}},_destroy:function(){this._sid=null,this._url=null,this._items=null,this._classes=null,this._features=null,this._classItems=null,this._currentUser=null,clearTimeout(this._eventsInterval)}}),i.session=function(e,t){return new i.Session(e,t)},i.Session.include({_gis:{render:null,search:null,geocode:null,routing:null},getBaseGisUrl:function(e){if(!this.options.internalGis&&""!==this._url){var t=this._url.split("//");if(t.length>=2){var i={render:this._gisRenderUrl,search:this._gisSearchUrl,geocode:this._gisGeocodeUrl,routing:this._gisRoutingUrl}[e];if(i)return i+"/"+t[1]}}return this._url},getLocations:function(e,t,s){var n=this.getBaseGisUrl("geocode");e=i.extend({coords:null,flags:0,city_radius:0,dist_from_unit:0,txt_dist:"",house_detect_radius:0},e);try{e.coords=JSON.stringify(e.coords)}catch(r){return void s(2)}if(!t&&n+"/gis_geocode"in this._cache){var a=this._cache[n+"/gis_geocode"];return s.apply(a[0],a[1])}if(!(this._gis.geocode instanceof i.Request)){var o=""!==this.getBaseGisUrl("geocode")?"/gis_post?2":"/wialon/post.html?2";this._gis.geocode=new i.Request(n,o)}this._currentUser===Object(this._currentUser)&&"id"in this._currentUser&&(e.uid=this._currentUser.id);var l=this;this._gis.geocode.send(n+"/gis_geocode",e,function(){l._cache[n+"/gis_geocode"]=[this,arguments],s.apply(this,arguments)},s)}}),i.Session.mergeOptions({internalGis:!1}),i.Session.include({getCurrentTime:function(){return this._serverTime},getTimeZone:function(){var e=60*-(new Date).getTimezoneOffset();return this._currentUser&&"tz"in this._currentUser.prp?parseInt(this._currentUser.prp.tz)>>>0:e},getTimeZoneOffset:function(e){return e=e||this.getTimeZone(),(e&i.Util.time.dstFlags.TZ_TYPE_MASK)!==i.Util.time.dstFlags.TZ_TYPE_WITH_DST?e&i.Util.time.dstFlags.TZ_OFFSET_MASK:parseInt(2147483648&e?65535&e|4294901760:65535&e)},getDSTOffset:function(e){if(!e)return 0;var t=this.getTimeZone(),s=t&i.Util.time.dstFlags.TZ_TYPE_MASK,n=this.getTimeZoneOffset(t);if(s===i.Util.time.dstFlags.TZ_TYPE_WITH_DST&&(t&i.Util.time.dstFlags.TZ_DST_TYPE_MASK)===i.Util.time.dstFlags.TZ_DST_TYPE_NONE||s!==i.Util.time.dstFlags.TZ_TYPE_WITH_DST&&t&i.Util.time.dstFlags.TZ_DISABLE_DST_BIT)return 0;if(s===i.Util.time.dstFlags.TZ_TYPE_WITH_DST&&(t&i.Util.time.dstFlags.TZ_DST_TYPE_MASK)===i.Util.time.dstFlags.TZ_DST_TYPE_SERVER||s!==i.Util.time.dstFlags.TZ_TYPE_WITH_DST){var r=new Date;r.setTime(1e3*e);var a=new Date;a.setTime(1e3*(e-7776e3));var o=new Date;return o.setTime(1e3*(e+1296e4)),r.getTimezoneOffset()<a.getTimezoneOffset()||r.getTimezoneOffset()<o.getTimezoneOffset()?3600:0}var l=t&i.Util.time.dstFlags.TZ_CUSTOM_DST_MASK,_=new Date(1e3*(e+n)),u=0,c=0,h=_.getUTCFullYear(),d=l|h;if("undefined"==typeof i.Util.time._dstCache.from[d]||"undefined"==typeof i.Util.time._dstCache.to[d]){switch(l){case i.Util.time.dstRules.DST_MAR2SUN2AM_NOV1SUN2AM:u=i.Util.time.getWdayTime(h,2,2,0,0,2),c=i.Util.time.getWdayTime(h,10,1,0,0,2);break;case i.Util.time.dstRules.DST_MAR6SUN_OCT6SUN:u=i.Util.time.getWdayTime(h,2,6,0),c=i.Util.time.getWdayTime(h,9,6,0);break;case i.Util.time.dstRules.DST_MAR6SUN1AM_OCT6SUN1AM:u=i.Util.time.getWdayTime(h,2,6,0,0,1),c=i.Util.time.getWdayTime(h,9,6,0,2);break;case i.Util.time.dstRules.DST_MAR6THU_SEP6FRI:u=i.Util.time.getWdayTime(h,2,6,4),c=i.Util.time.getWdayTime(h,8,6,5);break;case i.Util.time.dstRules.DST_MAR6SUN2AM_OCT6SUN2AM:return u=i.Util.time.getWdayTime(h,2,6,0,0,2),c=i.Util.time.getWdayTime(h,9,6,0,0,2),e>1414281600?0:3600;case i.Util.time.dstRules.DST_MAR30_SEP21:u=i.Util.time.getWdayTime(h,2,0,-1,30),c=i.Util.time.getWdayTime(h,8,0,-1,21);break;case i.Util.time.dstRules.DST_APR1SUN2AM_OCT6SUN2AM:u=i.Util.time.getWdayTime(h,3,1,0,0,2),c=i.Util.time.getWdayTime(h,9,6,0,0,2);break;case i.Util.time.dstRules.DST_APR1_OCT6SUN:u=i.Util.time.getWdayTime(h,3,0,-1,1),c=i.Util.time.getWdayTime(h,9,6,0);break;case i.Util.time.dstRules.DST_APR6THU_SEP6THU:u=i.Util.time.getWdayTime(h,3,6,4),c=i.Util.time.getWdayTime(h,8,6,4);break;case i.Util.time.dstRules.DST_APR1_OCT1:u=i.Util.time.getWdayTime(h,3,0,-1,1),c=i.Util.time.getWdayTime(h,9,0,-1,1);break;case i.Util.time.dstRules.DST_MAR21_22SUN_SEP20_21SUN:var f=i.Util.time.isLeapYear(h);u=i.Util.time.getWdayTime(h,2,0,-1,f?21:22),c=i.Util.time.getWdayTime(h,8,0,-1,f?20:21,23,0,0);break;case i.Util.time.dstRules.DST_SEP1SUNAFTER7_APR1SUNAFTER5:u=i.Util.time.getWdayTime(h,8,1,0,7),c=i.Util.time.getWdayTime(h,3,1,0,5);break;case i.Util.time.dstRules.DST_SEP1SUN_APR1SUN:u=i.Util.time.getWdayTime(h,8,1,0),c=i.Util.time.getWdayTime(h,3,1,0);break;case i.Util.time.dstRules.DST_SEP6SUN_APR1SUN:u=i.Util.time.getWdayTime(h,8,6,0),c=i.Util.time.getWdayTime(h,3,1,0);break;case i.Util.time.dstRules.DST_OCT2SUN_MAR2SUN:u=i.Util.time.getWdayTime(h,9,2,0),c=i.Util.time.getWdayTime(h,2,2,0);break;case i.Util.time.dstRules.DST_OCT1SUN_FEB3SUN:u=i.Util.time.getWdayTime(h,9,3,0),c=i.Util.time.getWdayTime(h,1,3,0);break;case i.Util.time.dstRules.DST_OCT3SUN_MAR2SUN:u=i.Util.time.getWdayTime(h,9,3,0),c=i.Util.time.getWdayTime(h,2,2,0);break;case i.Util.time.dstRules.DST_OCT1SUN_MAR2SUN:u=i.Util.time.getWdayTime(h,9,1,0),c=i.Util.time.getWdayTime(h,2,2,0);break;case i.Util.time.dstRules.DST_OCT1SUN_APR1SUN:u=i.Util.time.getWdayTime(h,9,1,0),c=i.Util.time.getWdayTime(h,3,1,0);break;case i.Util.time.dstRules.DST_OCT1SUN_MAR6SUN:u=i.Util.time.getWdayTime(h,9,1,0),c=i.Util.time.getWdayTime(h,2,6,0);break;case i.Util.time.dstRules.DST_OCT6SUN_JAN6SUN:u=i.Util.time.getWdayTime(h,9,6,0),c=i.Util.time.getWdayTime(h,0,6,0);break;default:return 0}i.Util.time._dstCache.from[d]=u,c%2===0&&c--,i.Util.time._dstCache.to[d]=c}else u=i.Util.time._dstCache.from[d],c=i.Util.time._dstCache.to[d];var m=(t&i.Util.time.dstFlags.TZ_DST_TYPE_MASK)===i.Util.time.dstFlags.TZ_DST_TYPE_CUSTOM_UTC?u:u-n,T=(t&i.Util.time.dstFlags.TZ_DST_TYPE_MASK)===i.Util.time.dstFlags.TZ_DST_TYPE_CUSTOM_UTC?c:c-n;return l>=i.Util.time.dstRules.DST_SOUTHERN_SEMISPHERE?e<=m&&e>=T?0:3600:e>=m&&e<=T?3600:0},getUserTime:function(e,t){return t=null===t||t,e+=this.getDSTOffset(e)+this.getTimeZoneOffset(),e-(t?0:i.Util.time.getTimeZoneOffset())},getLocale:function(e,t){if(!this._currentUser)return e({error:6});if(!t&&"user/get_locale"in this._cache){var i=this._cache["user/get_locale"];return e.apply(i[0],i[1])}var s=this,n={params:{userId:this._currentUser.id}};this.execute("user/get_locale",n,function(){s._cache["user/get_locale"]=[this,arguments],e.apply(this,arguments)})},updateLocale:function(e,t){return this._currentUser?(e={params:i.extend({userId:this._currentUser.id},e)},void this.execute("user/update_locale",e,t)):t({error:4})}}),i.Session.prototype.api.core={update_data_flags:function(e,t){this._request.api("core/update_data_flags",{params:e,sid:this._sid},this._updateDataFlagsCallback.bind(this,t))},login:function(e,t){i.extend({user:null,password:null,operateAs:""},e),this._request.api("core/login",{params:e},this._loginCallback.bind(this,t))},logout:function(e){this._request.api("core/logout",{params:{},sid:this._sid},this._logoutCallback.bind(this,e))},use_auth_hash:function(e,t){this._request.api("core/use_auth_hash",{params:e},this._loginCallback.bind(this,t))},duplicate:function(e,t){e.sid||t&&t({error:1});var i=e.sid;delete e.sid,this._request.api("core/duplicate",{params:e,sid:i},this._loginCallback.bind(this,t))}},i.Session.prototype.api.token={login:function(e,t){this._request.api("token/login",{params:e},this._loginCallback.bind(this,t))}}}(window);